<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>X3's Memo - Playlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="https://placehold.co/32x32/000000/FFFFFF?text=X3" />
    <link rel="stylesheet" href="src/style.css">

    
</head>
<body class="min-h-screen flex flex-col items-center justify-between selection:bg-green-500 selection:text-white">
    <header class="main-header w-full text-center shadow-lg">
        <div class="container mx-auto px-4"> 
            <h1 id="pageHeaderTitle" class="header-title">X3's Memo</h1>
        </div>
    </header>

    <main class="w-full flex-grow flex justify-center items-center p-4"> 
        <div class="container mx-auto max-w-2xl w-full bg-white bg-opacity-90 backdrop-blur-sm shadow-2xl rounded-xl p-6 md:p-10 space-y-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="text-center">
                    <img src="src/imgs/DSC08948.JPG" alt="Group photo 1"
                        class="album-image w-full h-auto object-cover rounded-lg border-4 border-pink-500 shadow-lg"
                        onclick="openModal(this.src)"
                        onerror="this.onerror=null;this.src='https://placehold.co/600x400/DB2777/FFFFFF?text=Img+1+Not+Found';this.alt='Image DSC08948.jpg not found';" />
                </div>
                <div class="text-center">
                    <img src="src/imgs/DSC08951.JPG" alt="Group photo 2"
                        class="album-image w-full h-auto object-cover rounded-lg border-4 border-indigo-500 shadow-lg"
                        onclick="openModal(this.src)"
                        onerror="this.onerror=null;this.src='https://placehold.co/600x400/4F46E5/FFFFFF?text=Img+2+Not+Found';this.alt='Image DSC08951.jpg not found';" />
                </div>
            </div>

            <div id="musicInfoCard" class="music-info-card bg-gray-800 text-white p-6 rounded-lg shadow-xl flex flex-col items-center space-y-4">
                <img id="musicCover" src="src/imgs/laskarPelCov.png" alt="Music Cover"
                    class="music-cover-image w-32 h-32 md:w-40 md:h-40 object-cover rounded-md border-2 border-green-400 shadow-lg mb-4"
                    onerror="this.onerror=null;this.src='https://placehold.co/150x150/1DB954/FFFFFF?text=Cover+Missing';this.alt='Music cover not found';" />
                <div class="text-center">
                    <p id="musicTitle" class="text-2xl md:text-3xl font-semibold tracking-wide">Laskar Pelangi</p>
                    <p id="musicArtist" class="text-md md:text-lg font-light text-gray-300">Nidji</p>
                </div>
                <div class="music-visualizer self-center mt-4">
                    <div class="visualizer-bar"></div><div class="visualizer-bar"></div><div class="visualizer-bar"></div><div class="visualizer-bar"></div><div class="visualizer-bar"></div><div class="visualizer-bar"></div><div class="visualizer-bar"></div>
                </div>
                 <div class="flex items-center justify-center space-x-4 mt-6 w-full">
                    <button id="prevButton" title="Previous Song"
                            class="player-control-button text-gray-300 hover:text-white transition-colors duration-200 p-2 rounded-full hover:bg-gray-700">
                        <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></svg>
                    </button>
                    <button id="playPauseButton" title="Play/Pause"
                            class="bg-green-500 hover:bg-green-600 text-white font-bold p-3 rounded-full shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75">
                        <svg fill="#FFFFFF" width="20px" height="20px" viewBox="0 0 16 16" id="playIcon"><path d="M5.008 12.897a.644.644 0 0 1-.91-.227.719.719 0 0 1-.098-.364V3.693C4 3.31 4.296 3 4.662 3a.64.64 0 0 1 .346.103l6.677 4.306a.713.713 0 0 1 0 1.182l-6.677 4.306z"/></svg>
                        <svg fill="#FFFFFF" width="20px" height="20px" viewBox="0 0 24 24" id="pauseIcon"><path d="M19,4V20a2,2,0,0,1-2,2H15a2,2,0,0,1-2-2V4a2,2,0,0,1,2-2h2A2,2,0,0,1,19,4ZM9,2H7A2,2,0,0,0,5,4V20a2,2,0,0,0,2,2H9a2,2,0,0,0,2-2V4A2,2,0,0,0,9,2Z"></path></svg>
                    </button>
                    <button id="nextButton" title="Next Song"
                            class="player-control-button text-gray-300 hover:text-white transition-colors duration-200 p-2 rounded-full hover:bg-gray-700">
                        <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="imageModal" class="modal" onclick="closeModalOutside(event)">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="modalImage" />
        </div>
    </main>

    <footer class="w-full p-4"> 
        <div class="main-footer">
            <p class="info-center">
                <b>By X3 For X3 - 2024/2025</b>
                <span>|</span> <span>Melvin "V3lt" Deandra</span>
                <span>|</span> <span>Aaron "Powon" Gilson</span>
                <span>|</span> <span>Jesson "Salcash" Gaddiel</span>
            </p>
        </div>
    </footer>

    <audio id="musicPlayer"></audio> 
    <script>
        const music = document.getElementById("musicPlayer");
        const playPauseButton = document.getElementById("playPauseButton");
        const playIcon = document.getElementById("playIcon");
        const pauseIcon = document.getElementById("pauseIcon");
        const prevButton = document.getElementById("prevButton");
        const nextButton = document.getElementById("nextButton");

        const musicTitleElement = document.getElementById("musicTitle");
        const musicArtistElement = document.getElementById("musicArtist");
        const musicCoverElement = document.getElementById("musicCover");
        const visualizerBars = document.querySelectorAll(".visualizer-bar");
        const musicInfoCard = document.getElementById("musicInfoCard"); 
        const pageHeaderTitleElement = document.getElementById("pageHeaderTitle"); 

        const originalHeaderTitle = "X3's Memo";
        const hoverHeaderTitle = "Khara's Memo";

    
        const playlist = [
            {
                title: "See You Again", 
                artist: "Wiz Khalifa ft. Charlie Puth",
                musicSrc: "src/music/SeeYouAgain.mp3", 
                coverSrc: "src/imgs/SeeYouAgCov.jpg",
                containerColor: "#2d115a",
                barColor: "#ff18b2"
            },{
                title: "Laskar Pelangi",
                artist: "Nidji",
                musicSrc: "src/music/laskarPelangi.mpeg", 
                coverSrc: "src/imgs/laskarPelCov.png", 
                containerColor: "#1f2937",
                barColor: "#ec1616"
            },
            {
                title: "Kembali Pulang", 
                artist: "Suara Kayu & Feby Putri",
                musicSrc: "src/music/Kembali Pulang.mp3", 
                coverSrc: "src/imgs/kembaliPulCov.png", 
                containerColor: "#3730a3",
                barColor: "#1dd457"
            }
        ];

        let currentSongIndex = 0; 
        let musicPlayedOnce = false; 
        let playAfterLoad = false; 
        let headerTransitionTimeout; 

        function loadSong(songIndex) {
            const song = playlist[songIndex];
            musicTitleElement.textContent = song.title;
            musicArtistElement.textContent = song.artist;
            
            musicCoverElement.style.opacity = '0';
            musicCoverElement.style.transform = 'scale(0.9)'; 


            setTimeout(() => {
                const tempImage = new Image();
                tempImage.onload = () => {
                    musicCoverElement.src = tempImage.src; 
                    musicCoverElement.style.opacity = '1';
                    musicCoverElement.style.transform = 'scale(1)'; 
                };
                tempImage.onerror = () => { 
                    console.error(`Error loading cover image: ${song.coverSrc}`);
                    musicCoverElement.style.opacity = '1'; 
                    musicCoverElement.style.transform = 'scale(1)'; 
                };
                tempImage.src = song.coverSrc; 
                
                musicCoverElement.onerror = () => { 
                    musicCoverElement.src='https://placehold.co/150x150/1DB954/FFFFFF?text=Cover+Missing';
                    musicCoverElement.alt=`${song.title} - Cover Not Found`;
                    musicCoverElement.style.opacity = '1';
                    musicCoverElement.style.transform = 'scale(1)';
                };
            }, 400); 


            if (song.containerColor) {
                musicInfoCard.style.backgroundColor = song.containerColor;
            } else {
                musicInfoCard.style.backgroundColor = "#1f2937"; 
            }

            if (song.barColor){
                visualizerBars.forEach(bar => bar.style.backgroundColor = song.barColor);
            } else {
                visualizerBars.forEach(bar => bar.style.backgroundColor = "#1dd457");
            }

            const existingSource = music.querySelector("source");
            if (existingSource) {
                music.removeChild(existingSource);
            }
            const sourceElement = document.createElement("source");
            sourceElement.src = song.musicSrc;
            sourceElement.type = "audio/mpeg";
            music.appendChild(sourceElement);
            
            music.load(); 
            updatePlayPauseIcon(true); 
            pauseVisualizer();
            console.log(`Song "${song.title}" load initiated. playAfterLoad is currently: ${playAfterLoad}`);
        }

        music.addEventListener('loadeddata', () => {
            console.log(`Music data loaded. playAfterLoad is currently: ${playAfterLoad}`);
            if (playAfterLoad) {
                console.log('Attempting to play after song data loaded...'); 
                const playPromise = music.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        console.log('Playback started successfully after loadeddata.');
                    }).catch(error => {
                        console.error("Error playing after loadeddata (autoplay likely prevented by browser):", error);
                        updatePlayPauseIcon(true); 
                        pauseVisualizer();      
                    });
                }
                playAfterLoad = false; 
            } else {
                console.log('playAfterLoad was false. Not attempting to play automatically.');
            }
        });

        function updatePlayPauseIcon(isPaused) {
            if (isPaused) {
                playIcon.style.display = "block";
                pauseIcon.style.display = "none";
                playPauseButton.title = "Play";
            } else {
                playIcon.style.display = "none";
                pauseIcon.style.display = "block";
                playPauseButton.title = "Pause";
            }
        }
        
        function playVisualizer() {
            visualizerBars.forEach(bar => bar.style.animationPlayState = "running");
        }
        function pauseVisualizer() {
            visualizerBars.forEach(bar => bar.style.animationPlayState = "paused");
        }

        function togglePlayPause() {
            if (music.paused) {
                const playPromise = music.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                       
                    }).catch(error => {
                        console.error("Error in togglePlayPause (play):", error);
                        updatePlayPauseIcon(true); 
                        pauseVisualizer();
                    });
                }
            } else {
                music.pause();
            }
        }

        function playNextSong() {
            console.log('playNextSong called. Setting playAfterLoad = true.');
            currentSongIndex = (currentSongIndex + 1) % playlist.length; 
            playAfterLoad = true; 
            loadSong(currentSongIndex); 
        }

        function playPrevSong() {
            console.log('playPrevSong called. Setting playAfterLoad = true.');
            currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length; 
            playAfterLoad = true; 
            loadSong(currentSongIndex); 
        }

        playPauseButton.addEventListener("click", togglePlayPause);
        nextButton.addEventListener("click", playNextSong);
        prevButton.addEventListener("click", playPrevSong);

        playPauseButton.addEventListener('mouseenter', () => {
            musicInfoCard.classList.add('music-container-glow');
        });
        playPauseButton.addEventListener('mouseleave', () => {
            musicInfoCard.classList.remove('music-container-glow');
        });

        if (pageHeaderTitleElement) {
            pageHeaderTitleElement.addEventListener('mouseenter', () => {
                console.log('[DEBUG] Header mouseenter. Current text before fade:', pageHeaderTitleElement.textContent, '| Target text:', hoverHeaderTitle);
                clearTimeout(headerTransitionTimeout); 
                pageHeaderTitleElement.style.opacity = '0';
                headerTransitionTimeout = setTimeout(() => {
                    console.log('[DEBUG] Inside mouseenter timeout. Setting text to:', hoverHeaderTitle);
                    pageHeaderTitleElement.textContent = hoverHeaderTitle;
                    pageHeaderTitleElement.style.opacity = '1';
                    console.log('[DEBUG] Header text changed to (after timeout):', pageHeaderTitleElement.textContent);
                }, 200); 
            });
            pageHeaderTitleElement.addEventListener('mouseleave', () => {
                console.log('[DEBUG] Header mouseleave. Current text before fade:', pageHeaderTitleElement.textContent, '| Target text:', originalHeaderTitle);
                clearTimeout(headerTransitionTimeout); 
                pageHeaderTitleElement.style.opacity = '0';
                headerTransitionTimeout = setTimeout(() => {
                    console.log('[DEBUG] Inside mouseleave timeout. Setting text to:', originalHeaderTitle);
                    pageHeaderTitleElement.textContent = originalHeaderTitle;
                    pageHeaderTitleElement.style.opacity = '1';
                    console.log('[DEBUG] Header text changed back to (after timeout):', pageHeaderTitleElement.textContent);
                }, 200); 
            });
        }


        music.onended = () => { 
            console.log("Song ended, calling playNextSong."); 
            playNextSong();
        };
        music.onpause = () => { 
            console.log("Music paused."); 
            updatePlayPauseIcon(true);
            pauseVisualizer(); 
        };
        music.onplay = () => { 
            console.log("Music playing."); 
            updatePlayPauseIcon(false);
            playVisualizer(); 
            if (!musicPlayedOnce) musicPlayedOnce = true; 
        };
        
        loadSong(currentSongIndex); 

        setTimeout(() => {
            if (!musicPlayedOnce && music.paused) { 
                console.log("Attempting initial delayed autoplay...");
                playAfterLoad = true; 
                const playPromise = music.play(); 
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        console.log("Initial delayed autoplay successful.");
                    }).catch(error => {
                        console.warn("Initial autoplay was prevented. User interaction is needed.", error);
                        updatePlayPauseIcon(true); 
                        pauseVisualizer();
                        playAfterLoad = false; 
                    });
                } else {
                     playAfterLoad = false; 
                }
            }
        }, 1000); 

        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");

        function openModal(src) { 
            modal.style.display = "flex"; 
            modalImg.src = src; 
            if (!music.paused) { 
                 pauseVisualizer();
            }
        }

        function closeModal() { 
            modal.style.display = "none"; 
            if (!music.paused) { 
                 playVisualizer();
            }
        }
        function closeModalOutside(event) { 
            if (event.target === modal) closeModal();
        }
        document.addEventListener("keydown", function (event) {
            if (event.key === "Escape" && modal.style.display === "flex") closeModal();
        });

    </script>
</body>
</html>
